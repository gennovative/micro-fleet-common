{"version":3,"sources":["app/models/settings/DatabaseSettings.ts"],"names":[],"mappings":"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","file":"DatabaseSettings.js","sourcesContent":["import { DbSettingKeys as S } from '../../constants/setting-keys/database';\r\nimport { IConfigurationProvider, IDbConnectionDetail } from '../../interfaces/configurations';\r\nimport { SettingItem, SettingItemDataType } from './SettingItem';\r\n\r\n\r\n/**\r\n * Wraps an array of database settings.\r\n */\r\nexport class DatabaseSettings\r\n\textends Array<SettingItem> {\r\n\r\n\tpublic static fromProvider(provider: IConfigurationProvider): IDbConnectionDetail[] {\r\n\t\tlet nConn = <number>provider.get(S.DB_NUM_CONN),\r\n\t\t\tdetails = [],\r\n\t\t\td;\r\n\r\n\t\tfor (let i = 0; i < nConn; ++i) {\r\n\t\t\td = this.buildConnDetails(i, provider);\r\n\t\t\tif (!d) { continue; }\r\n\t\t\tdetails.push(d);\r\n\t\t}\r\n\t\treturn details.length ? details : null;\r\n\t}\r\n\r\n\tprivate static buildConnDetails(connIdx: number, provider: IConfigurationProvider): IDbConnectionDetail {\r\n\t\tlet cnnDetail: IDbConnectionDetail = {\r\n\t\t\t\tclientName: provider.get(S.DB_ENGINE + connIdx) // Must belong to `DbClient`\r\n\t\t\t},\r\n\t\t\tvalue: string;\r\n\r\n\t\t// 1st priority: connect to a local file.\r\n\t\tvalue = provider.get(S.DB_FILE + connIdx);\r\n\t\tif (value) {\r\n\t\t\tcnnDetail.filePath = value;\r\n\t\t\treturn cnnDetail;\r\n\t\t}\r\n\r\n\t\t// 2nd priority: connect with a connection string.\r\n\t\tvalue = provider.get(S.DB_CONN_STRING + connIdx);\r\n\t\tif (value) {\r\n\t\t\tcnnDetail.connectionString = value;\r\n\t\t\treturn cnnDetail;\r\n\t\t}\r\n\r\n\t\t// Last priority: connect with host credentials.\r\n\t\tvalue = provider.get(S.DB_HOST + connIdx);\r\n\t\tif (value) {\r\n\t\t\tcnnDetail.host = {\r\n\t\t\t\taddress: provider.get(S.DB_HOST + connIdx),\r\n\t\t\t\tuser: provider.get(S.DB_USER + connIdx),\r\n\t\t\t\tpassword: provider.get(S.DB_PASSWORD + connIdx),\r\n\t\t\t\tdatabase: provider.get(S.DB_NAME + connIdx),\r\n\t\t\t};\r\n\t\t\treturn cnnDetail;\r\n\t\t}\r\n\t\treturn null;\r\n\t}\r\n\r\n\r\n\tprivate _countSetting: SettingItem;\r\n\r\n\tconstructor() {\r\n\t\tsuper();\r\n\t\tthis._countSetting = SettingItem.translator.whole({\r\n\t\t\tname: S.DB_NUM_CONN,\r\n\t\t\tdataType: SettingItemDataType.Number,\r\n\t\t\tvalue: '0'\r\n\t\t});\r\n\r\n\t\tthis.push(this._countSetting);\r\n\t}\r\n\r\n\r\n\t/**\r\n\t * Gets number of connection settings.\r\n\t */\r\n\tpublic get total(): number {\r\n\t\treturn parseInt(this._countSetting.value);\r\n\t}\r\n\r\n\t/**\r\n\t * Parses then adds connection detail to setting item array.\r\n\t */\r\n\tpublic pushConnection(detail: IDbConnectionDetail) {\r\n\t\tlet newIdx = parseInt(this._countSetting.value);\r\n\r\n\t\tthis.push(SettingItem.translator.whole({\r\n\t\t\t\tname: S.DB_ENGINE + newIdx,\r\n\t\t\t\tdataType: SettingItemDataType.String,\r\n\t\t\t\tvalue: detail.clientName\r\n\t\t\t}));\r\n\r\n\t\tif (detail.host) {\r\n\t\t\tthis.push(SettingItem.translator.whole({\r\n\t\t\t\t\tname: S.DB_HOST + newIdx,\r\n\t\t\t\t\tdataType: SettingItemDataType.String,\r\n\t\t\t\t\tvalue: detail.host.address\r\n\t\t\t\t}));\r\n\t\t\tthis.push(SettingItem.translator.whole({\r\n\t\t\t\t\tname: S.DB_USER + newIdx,\r\n\t\t\t\t\tdataType: SettingItemDataType.String,\r\n\t\t\t\t\tvalue: detail.host.user\r\n\t\t\t\t}));\r\n\t\t\tthis.push(SettingItem.translator.whole({\r\n\t\t\t\t\tname: S.DB_PASSWORD + newIdx,\r\n\t\t\t\t\tdataType: SettingItemDataType.String,\r\n\t\t\t\t\tvalue: detail.host.password\r\n\t\t\t\t}));\r\n\t\t\tthis.push(SettingItem.translator.whole({\r\n\t\t\t\t\tname: S.DB_NAME + newIdx,\r\n\t\t\t\t\tdataType: SettingItemDataType.String,\r\n\t\t\t\t\tvalue: detail.host.database\r\n\t\t\t\t}));\r\n\t\t} else if (detail.filePath) {\r\n\t\t\tthis.push(SettingItem.translator.whole({\r\n\t\t\t\t\tname: S.DB_FILE + newIdx,\r\n\t\t\t\t\tdataType: SettingItemDataType.String,\r\n\t\t\t\t\tvalue: detail.filePath\r\n\t\t\t\t}));\r\n\t\t} else {\r\n\t\t\tthis.push(SettingItem.translator.whole(\r\n\t\t\t\t{\r\n\t\t\t\t\tname: S.DB_CONN_STRING + newIdx,\r\n\t\t\t\t\tdataType: SettingItemDataType.String,\r\n\t\t\t\t\tvalue: detail.connectionString\r\n\t\t\t\t}));\r\n\t\t}\r\n\r\n\t\tlet setting: any = this._countSetting;\r\n\t\tsetting.value = (newIdx + 1) + '';\r\n\t}\r\n}"]}